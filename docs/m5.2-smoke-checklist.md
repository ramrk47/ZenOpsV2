# M5.2 Smoke Checklist

## Identity and routing
1. `GET /v1/meta` and `GET /v1/health` from each routed host (`api`, `studio`, `web`, `portal`).
2. Confirm V2 identity reports `app=zenops-v2`.

## Payments (dev bypass mode)
1. Set `PAYMENT_WEBHOOK_DEV_BYPASS=true` in non-production smoke environments only.
2. Create billing account via `/v1/control/accounts`.
3. Create topup via `/v1/payments/topup`.
4. Send simulated Razorpay webhook to `/v1/payments/webhooks/razorpay`.
5. Verify wallet increased and only one `payment_events` row is processed for duplicate delivery.

## Credits lifecycle
1. Switch account policy to `CREDIT`.
2. Reserve credits (`/v1/control/credits/reserve`) and verify `reserved` increases.
3. Consume reservation and verify wallet/available transitions.
4. Reserve again and release; verify reserved returns.
5. Run reconcile dry-run and normal run; verify no invariant drift.

## Subscriptions lifecycle
1. Assign subscription plan from Studio or `/v1/control/subscriptions`.
2. Trigger manual refill (`/v1/control/subscriptions/:id/refill`) and verify grant event.
3. Run due-refill processor (`/v1/control/subscriptions/refill-due`) and verify idempotent behavior.
4. Move subscription through `past_due`, `suspended`, and `active` states and confirm timeline entries.

## Postpaid invoice flow
1. Switch account policy to `POSTPAID`.
2. Create draft invoice -> issue -> mark paid.
3. Create payment checkout link for invoice and verify payment order rows appear.
4. In portal/web, confirm pay-link + manual payment-proof fallback are both visible.
