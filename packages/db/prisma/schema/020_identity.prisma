model Tenant {
  id          String       @id @default(uuid()) @db.Uuid
  slug        String       @unique
  name        String
  lane        TenantLane   @default(tenant)
  repogenFeaturesJson Json @default("{}") @db.JsonB @map("repogen_features_json")
  deletedAt   DateTime?    @map("deleted_at")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  memberships Membership[]
  partners    Partner[]
  plans       Plan[]
  workOrders  WorkOrder[]
  assignments Assignment[]
  assignmentAssignees AssignmentAssignee[]
  assignmentFloors AssignmentFloor[]
  assignmentTasks AssignmentTask[]
  assignmentMessages AssignmentMessage[]
  assignmentActivities AssignmentActivity[]
  billingPlans BillingPlan[]
  tenantBilling TenantBilling?
  usageEvents UsageEvent[]
  invoices Invoice[]
  invoiceLines InvoiceLine[]
  payments Payment[]
  reportRequests ReportRequest[]
  reportJobs      ReportJob[]
  reportArtifacts ReportArtifact[]
  artifactVersions ArtifactVersion[]
  reportTemplates ReportTemplate[]
  templateVersions TemplateVersion[]
  reportPacks ReportPack[]
  reportPackArtifacts ReportPackArtifact[]
  reportFieldValues ReportFieldValue[]
  reportEvidenceLinks ReportEvidenceLink[]
  repogenGenerationJobs ReportGenerationJob[]
  reportAuditLogs ReportAuditLog[]
  creditsLedger CreditsLedger[]
  auditEvents AuditEvent[]
  documents Document[]
  documentLinks DocumentLink[]
  documentTagKeys DocumentTagKey[]
  documentTagValues DocumentTagValue[]
  documentTagMap DocumentTagMap[]
  reportInputs ReportInput[]
  extractionRuns ExtractionRun[]
  contactPoints ContactPoint[]
  notificationTemplates NotificationTemplate[]
  notificationOutbox NotificationOutbox[]
  notificationAttempts NotificationAttempt[]
  webhookEvents WebhookEvent[]
  employees Employee[]
  attendanceEvents AttendanceEvent[]
  payrollPeriods PayrollPeriod[]
  payrollItems PayrollItem[]
  notificationTargetGroups NotificationTargetGroup[]
  notificationTargets NotificationTarget[]
  notificationSubscriptions NotificationSubscription[]
  banks        Bank[]
  bankBranches BankBranch[]
  clientOrgs   ClientOrg[]
  contacts     Contact[]
  properties   Property[]
  channels     Channel[]
  assignmentSources AssignmentSourceRecord[]
  assignmentStageTransitions AssignmentStageTransition[]
  assignmentStatusHistory AssignmentStatusHistory[]
  assignmentSignals AssignmentSignal[]
  tasks        Task[]
  channelRequests ChannelRequest[]
  branchContacts BranchContact[]

  @@map("tenants")
}

model User {
  id          String       @id @default(uuid()) @db.Uuid
  email       String       @unique
  name        String
  deletedAt   DateTime?    @map("deleted_at")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  memberships Membership[]
  createdAssignments Assignment[] @relation("AssignmentCreatedBy")
  assignmentAssignees AssignmentAssignee[]
  assignedTasks AssignmentTask[] @relation("AssignmentTaskAssignee")
  assignmentMessages AssignmentMessage[] @relation("AssignmentMessageAuthor")
  assignmentActivities AssignmentActivity[] @relation("AssignmentActivityActor")
  createdPayments Payment[] @relation("PaymentCreatedBy")
  workOrders  WorkOrder[]  @relation("PortalUserWorkOrders")
  artifactVersions ArtifactVersion[]
  auditEvents AuditEvent[]
  ownedDocuments Document[] @relation("DocumentOwner")
  contactPoints ContactPoint[]
  employeeProfiles Employee[] @relation("EmployeeUser")
  createdAttendanceEvents AttendanceEvent[] @relation("AttendanceEventCreatedBy")
  reviewedBanks Bank[] @relation("BankReviewedBy")
  reviewedBankBranches BankBranch[] @relation("BankBranchReviewedBy")
  reviewedClientOrgs ClientOrg[] @relation("ClientOrgReviewedBy")
  channelRecords Channel[] @relation("ChannelOwner")
  reviewedChannels Channel[] @relation("ChannelReviewedBy")
  assignmentSourceRecords AssignmentSourceRecord[] @relation("AssignmentSourceRecordedBy")
  assignmentStageChanges AssignmentStageTransition[] @relation("AssignmentStageChangedBy")
  assignmentStatusHistoryChanges AssignmentStatusHistory[] @relation("AssignmentStatusHistoryChangedBy")
  assignedOpsTasks Task[] @relation("TaskAssignedTo")
  createdOpsTasks  Task[] @relation("TaskCreatedBy")
  channelRequests ChannelRequest[] @relation("ChannelRequestRequestedBy")

  @@map("users")
}

model Role {
  id          String       @id @default(uuid()) @db.Uuid
  name        String       @unique
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  memberships Membership[]

  @@map("roles")
}

model Membership {
  id          String    @id @default(uuid()) @db.Uuid
  tenantId    String    @map("tenant_id") @db.Uuid
  userId      String    @map("user_id") @db.Uuid
  roleId      String    @map("role_id") @db.Uuid
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  tenant      Tenant    @relation(fields: [tenantId], references: [id])
  user        User      @relation(fields: [userId], references: [id])
  role        Role      @relation(fields: [roleId], references: [id])

  @@unique([tenantId, userId, roleId])
  @@index([tenantId])
  @@index([userId])
  @@map("memberships")
}

model Partner {
  id          String    @id @default(uuid()) @db.Uuid
  tenantId    String    @map("tenant_id") @db.Uuid
  name        String
  deletedAt   DateTime? @map("deleted_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  tenant      Tenant    @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@map("partners")
}
