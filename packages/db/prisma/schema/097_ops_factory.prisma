model BranchContact {
  id          String     @id @default(uuid()) @db.Uuid
  tenantId    String     @map("tenant_id") @db.Uuid
  branchId    String     @map("branch_id") @db.Uuid
  name        String
  phone       String?
  email       String?
  role        String?
  deletedAt   DateTime?  @map("deleted_at")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  tenant      Tenant     @relation(fields: [tenantId], references: [id])
  branch      BankBranch @relation(fields: [branchId], references: [id])

  @@index([tenantId, branchId])
  @@index([tenantId, createdAt])
  @@map("branch_contacts")
}

model Task {
  id               String       @id @default(uuid()) @db.Uuid
  tenantId         String       @map("tenant_id") @db.Uuid
  assignmentId     String?      @map("assignment_id") @db.Uuid
  title            String
  description      String?
  status           TaskStatus   @default(open)
  isOverdue        Boolean      @default(false) @map("is_overdue")
  priority         TaskPriority @default(medium)
  dueAt            DateTime?    @map("due_at")
  assignedToUserId String?      @map("assigned_to_user_id") @db.Uuid
  createdByUserId  String       @map("created_by_user_id") @db.Uuid
  deletedAt        DateTime?    @map("deleted_at")
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")
  tenant           Tenant       @relation(fields: [tenantId], references: [id])
  assignment       Assignment?  @relation(fields: [assignmentId], references: [id])
  assignedToUser   User?        @relation("TaskAssignedTo", fields: [assignedToUserId], references: [id])
  createdByUser    User         @relation("TaskCreatedBy", fields: [createdByUserId], references: [id])

  @@index([tenantId, status])
  @@index([tenantId, assignedToUserId, status])
  @@index([tenantId, dueAt])
  @@index([tenantId, assignmentId, createdAt])
  @@map("tasks")
}

model AssignmentStatusHistory {
  id              String           @id @default(uuid()) @db.Uuid
  tenantId        String           @map("tenant_id") @db.Uuid
  assignmentId    String           @map("assignment_id") @db.Uuid
  fromStatus      AssignmentStage? @map("from_status")
  toStatus        AssignmentStage  @map("to_status")
  changedByUserId String?          @map("changed_by_user_id") @db.Uuid
  note            String?
  createdAt       DateTime         @default(now()) @map("created_at")
  tenant          Tenant           @relation(fields: [tenantId], references: [id])
  assignment      Assignment       @relation(fields: [assignmentId], references: [id])
  changedByUser   User?            @relation("AssignmentStatusHistoryChangedBy", fields: [changedByUserId], references: [id])

  @@index([tenantId, assignmentId, createdAt(sort: Desc)])
  @@index([tenantId, toStatus])
  @@index([changedByUserId])
  @@map("assignment_status_history")
}

model ChannelRequest {
  id                String               @id @default(uuid()) @db.Uuid
  tenantId          String               @map("tenant_id") @db.Uuid
  channelId         String               @map("channel_id") @db.Uuid
  requestedByUserId String               @map("requested_by_user_id") @db.Uuid
  assignmentId      String?              @map("assignment_id") @db.Uuid
  borrowerName      String               @map("borrower_name")
  phone             String
  propertyCity      String               @map("property_city")
  propertyAddress   String               @map("property_address")
  notes             String?
  status            ChannelRequestStatus @default(submitted)
  deletedAt         DateTime?            @map("deleted_at")
  createdAt         DateTime             @default(now()) @map("created_at")
  updatedAt         DateTime             @updatedAt @map("updated_at")
  tenant            Tenant               @relation(fields: [tenantId], references: [id])
  channel           Channel              @relation(fields: [channelId], references: [id])
  requestedByUser   User                 @relation("ChannelRequestRequestedBy", fields: [requestedByUserId], references: [id])
  assignment        Assignment?          @relation(fields: [assignmentId], references: [id])

  @@index([tenantId, channelId, createdAt(sort: Desc)])
  @@index([tenantId, requestedByUserId, createdAt(sort: Desc)])
  @@index([tenantId, status, createdAt(sort: Desc)])
  @@map("channel_requests")
}
